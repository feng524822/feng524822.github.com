(function(l){function t(a){return a.charAt(0).toUpperCase()+a.slice(1)}function h(a,b,c){var f,g,e,s;if(b instanceof Object)for(f in b)b.hasOwnProperty(f)&&arguments.callee(a,f,b[f]);else if(f=t(b),g=["Webkit","O","Moz","ms"],e=g.length,s=a.style,b in s)s[b]=c;else for(;e--;)if(b=g[e]+f,b in s){s[b]=c;break}}function n(a,b,c,f,g){n=a.addEventListener?function(a,b,c,f,g){a["e"+b+c]=c;a[b+c]=function(d){d.data=g;a["e"+b+c].call(f||l,d)};return a.addEventListener(b,a[b+c],!1)}:function(a,b,c,f,g){a["e"+
b+c]=c;a[b+c]=function(){var d=l.event;d.data=g;a["e"+b+c].call(f,d)};return a.attachEvent("on"+b,a[b+c])};n.apply(l,arguments)}function p(a,b,c){p=a.removeEventListener?function(a,b,c){return a.removeEventListener(b,a[b+c],!1)}:function(a,b,c){return a.detachEvent("on"+b,a[b+c])};p.apply(l,arguments)}function u(a,b,c,f){1===arguments.length&&p(a,q?"touchstart":"mousedown",r);n(a,q?"touchstart":"mousedown",r,null,{l:b,n:c,d:a,data:f})}function r(a){var b=a.data,c=document.documentElement.scrollLeft||
document.body.scrollLeft,f=document.documentElement.scrollTop||document.body.scrollTop;b.x=a.pageX||a.clientX+c;b.y=a.pageY||a.clientY+f;try{a.V=!1}catch(g){a.preventDefault()}switch(a.type){case "touchend":case "mouseup":b.type="endDrag";p(document,q?"touchmove":"mousemove",r);p(document,q?"touchend":"mouseup",r);b.l.call(b.n,b,a);break;case "touchmove":case "mousemove":b.type="moveDrag";b.i=b.x-b.offsetX;b.j=b.y-b.offsetY;b.l.call(b.n,b,a);break;case "mousedown":b.type="startDrag",b.offsetX=b.x,
b.offsetY=b.y,b.i=0,b.j=0,b.l.call(b.n,b)&&(n(document,q?"touchmove":"mousemove",r,null,b),n(document,q?"touchend":"mouseup",r,null,b))}}function v(a){this.m=a;this.g=100;this.padding=10;this.areas=[];this.e={};this.f=0;this.s()}var q="ontouchstart"in l||l.Z&&document instanceof DocumentTouch,d=v.prototype;d.s=function(){this.J();this.C();this.D();this.B();this.start()};d.reset=function(){var a=this.e;this.X();a.h.parentNode.removeChild(a.h);a.f.parentNode.removeChild(a.f);this.areas=[];this.e={};
this.f=0;this.s()};d.C=function(){var a="#f57 #a67 #7ba3e4 #9d7c1f #693465 #2c9d1f #1f4f9d #ae22a2 #e4e14d #32dee0 #c31c25".split(" ");this.r={};for(var b=0;b<a.length;b++)this.r[2<<b]=a[b]};d.J=function(){for(var a=0,b=[],c=0;4>c;c++){for(var f=[],g=0;4>g;g++)f.push(g),a++;b.push(f)}this.count=a;this.b=b};d.D=function(){this.I();this.K();this.G()};d.I=function(){var a=document.createElement("div");a.style.position="relative";this.m.appendChild(a);this.e.h=a;this.F();this.W()};d.W=function(){h(this.e.h,
{ba:"none",width:4*this.g+3*this.padding+"px",height:4*this.g+3*this.padding+"px"})};d.F=function(){for(var a,b=0;b<this.count;)a={index:b,a:0,d:null,A:null,left:b%4*(this.g+this.padding),top:Math.floor(b/4)*(this.g+this.padding)},this.areas.push(a),a.A=this.q(b,1),b++};d.q=function(a,b){var c=this.c(a),f=document.createElement("div");h(f,{position:"absolute",width:this.g+"px",height:this.g+"px",opacity:b?1:0,lineHeight:this.g+"px",textAlign:"center",borderRadius:"7px",left:c.left+"px",top:c.top+
"px",zIndex:!b+2,transition:"all 0.2s ease-in,opacity 0.4s linear",backgroundColor:"#fff5f5"});this.e.h.appendChild(f);return f};d.K=function(){var a=document.createElement("div");h(a,{width:"150px",height:"60px",lineHeight:"60px",fontWeight:"bold",borderRadius:"7px",background:"#272727",color:"#fff",textAlign:"center",fontSize:"24px",marginLeft:"auto",marginRight:"auto",marginTop:"20px"});this.e.f=a;this.m.appendChild(a)};d.G=function(){var a=this.e;a.control=document.createElement("div");this.m.appendChild(a.control);
h(a.control,{position:"absolute",right:"100px",bottom:"100px",width:"40px",height:"40px"});for(var a=["top","right","bottom","left"],b=0;b<a.length;b++)this.H(a[b])};d.H=function(a){var b=this.e,c=document.createElement("div");h(c,{width:"0",height:"0",position:"absolute",borderStyle:"solid",borderColor:"transparent",borderWidth:"20px"});var f={left:"right",top:"bottom"},g,e;for(e in f)f.hasOwnProperty(e)&&(e==a?g=f[e]:f[e]==a&&(g=e));h(c,g,"100%");h(c,"border"+t(g)+"Color","#333");h(c,"border"+t(g)+
"Width","40px");h(c,"border"+t(a)+"Width","0");b["ctrl"+a]=c;b.control.appendChild(c);n(c,"click",function(){this.dir=a.charAt(0);this.move()},this)};d.c=function(a){return this.areas[a]};d.aa=function(){var a=[];this.map(function(b){0===b.a&&a.push(b)});return a};d.P=function(a){return 0===this.c(a).a};d.U=function(){var a=Math.floor(Math.random()*this.count);return this.P(a)?a:arguments.callee.call(this)};d.map=function(a){for(var b=0;b<this.areas.length;b++)a.call(this,this.areas[b],b)};d.p=function(){var a=
2,b=this.U(),c=this.c(b),f=this.q(b);6.5<10*Math.random()&&(a=4);setTimeout(function(){h(f,"opacity",1)},20);h(f,{fontSize:"20px",color:"#fff"});c.a=a;c.d=f;this.w(b)};d.w=function(a){a=this.c(a);if(a.d)if(a.a){var b=a.d,c=a.a;try{b.innerText=c}catch(f){b.textContent=c}h(a.d,"background",this.r[a.a]||"#f47")}else this.e.h.removeChild(a.d);else a.a=0};d.v=function(){var a=this.e.f,b=this.f;try{a.innerText=b}catch(c){a.textContent=b}};d.M=function(){this.complete&&(l.alert("\u7ed3\u675f\u4e86\uff0c\u91cd\u65b0\u5f00\u59cb\u5427"),
l.$=this,console.log(this))};d.N=function(){var a=!1;this.map(function(b){0===b.a&&(a=!0)});return a};d.L=function(){return this.O()||this.Y()};d.O=function(){for(var a=!1,b=this,c=0;c<this.b.length;c++)this.b[c].sort(function(c,g){var e=b.c(c),d=b.c(g);if(e.a===d.a&&2048>d.a||0===e.a)a=!0;return e.index-d.index});return a};d.Y=function(){for(var a=!1,b=this,c=0;c<this.b.length;c++){for(var f=this.b[c],g=[],e=0;e<f.length;e++)g.push(c*f.length+e);g.sort(function(c,f){var e=b.c(c),g=b.c(f);if(e.a===
g.a&&2048>g.a||0===e.a)a=!0;return e.index-g.index})}return a};d.B=function(){u(this.e.h,this.DragEvent,this);n(document,"keydown",this.t,this)};d.X=function(){u(this.e.h);p(document,"keydown",this.t)};d.t=function(a){var b=a.keyCode||a.charCode||a.which;try{a.V=!1}catch(c){a.preventDefault()}switch(b){case 37:this.dir="l";break;case 38:this.dir="t";break;case 39:this.dir="r";break;case 40:this.dir="b"}this.move()};d.DragEvent=function(a){switch(a.type){case "endDrag":this.dir=0<=Math.abs(a.i)-Math.abs(a.j)?
0<a.i?"r":"l":0<a.j?"b":"t";(30<Math.abs(a.i)||30<Math.abs(a.j))&&this.move();document.body.style.cursor="default";break;case "moveDrag":document.body.style.cursor="move"}return!0};d.move=function(){if(this.u)return!1;this.u=!0;this.o=0;switch(this.dir){case "l":this.R();break;case "r":this.S();break;case "t":this.T();break;case "b":this.Q()}this.moveEnd()};d.moveEnd=function(){this.v();this.N()?this.o&&(this.p(),this.complete=!this.L()):this.complete=!0;this.M();this.u=!1;this.dir=null;this.o=0};
d.R=function(){for(var a,b,c,f,g,e,d,h,k=0;k<this.b.length;k++){h=this.b[k];g=f=-1;c=0;d=!1;b=this.b.length*k;for(var m=0;m<h.length;m++)a=b+m,e=this.c(a),e=e.a,g===e&&2048>e&&(c++,d=!0),0===f&&c++,e&&(g=e),d&&(g=-1,user=!1),f=e,this.k(a,Math.max(b,a-c))}};d.S=function(){for(var a,b,c,f,g,e,d,h,k=0;k<this.b.length;k++){h=this.b[k];g=f=-1;c=0;d=!1;b=h.length*(k+1)-1;for(var m=0;m<h.length;m++)a=b-m,e=this.c(a),e=e.a,g===e&&2048>e&&(c++,d=!0),0===f&&c++,e&&(g=e),f=e,d&&(g=-1,user=!1),this.k(a,Math.min(b,
a+c))}};d.T=function(){for(var a,b,c,f,d,e,h,l,k=0;k<this.b.length;k++){l=this.b[k];d=f=-1;c=0;h=!1;b=k;for(var m=0;m<l.length;m++)a=m*this.b.length+b,e=this.c(a),e=e.a,d===e&&2048>e&&(c+=this.b.length,h=!0),0===f&&(c+=this.b.length),e&&(d=e),f=e,h&&(d=-1,user=!1),this.k(a,Math.max(b,a-c))}};d.Q=function(){for(var a,b,c,f,d,e,h,l,k=0;k<this.b.length;k++){l=this.b[k];d=f=-1;c=0;h=!1;b=(this.b.length-1)*l.length+k;for(var m=0;m<l.length;m++)a=b-m*this.b.length,e=this.c(a),e=e.a,d===e&&2048>e&&(c+=this.b.length,
h=!0),0===f&&(c+=this.b.length),e&&(d=e),f=e,h&&(d=-1,user=!1),this.k(a,Math.min(b,a+c))}};d.k=function(a,b){var c=this.c(a),d=this.c(b);if(a!==b&&c.d){d.a+=c.a;if(d.d){var g=d.d;setTimeout(function(){g.parentNode.removeChild(g);g=null},200);this.f+=d.a}d.d=c.d;h(d.d,{left:d.left+"px",top:d.top+"px"});c.d=null;c.a=0;this.w(b);this.o++}};d.start=function(){this.p();this.p();this.v()};l.h2048=function(a){return new v(a)}})(window);