(function(p){function u(a){return a.charAt(0).toUpperCase()+a.slice(1)}function n(a,b,d){var f,g,e,c;if(b instanceof Object)for(f in b)b.hasOwnProperty(f)&&arguments.callee(a,f,b[f]);else if(f=u(b),g=["Webkit","O","Moz","ms"],e=g.length,c=a.style,b in c)c[b]=d;else for(;e--;)if(b=g[e]+f,b in c){c[b]=d;break}}function q(a,b,d,f,g){q=a.addEventListener?function(a,b,d,f,g){a["e"+b+d]=d;a[b+d]=function(c){c.data=g;a["e"+b+d].call(f||p,c)};return a.addEventListener(b,a[b+d],!1)}:function(a,b,d,f,g){a["e"+
b+d]=d;a[b+d]=function(){var c=p.event;c.data=g;a["e"+b+d].call(f,c)};return a.attachEvent("on"+b,a[b+d])};q.apply(p,arguments)}function r(a,b,d){r=a.removeEventListener?function(a,b,d){return a.removeEventListener(b,a[b+d],!1)}:function(a,b,d){return a.detachEvent("on"+b,a[b+d])};r.apply(p,arguments)}function v(a,b,d,f){1===arguments.length&&r(a,s?"touchstart":"mousedown",t);q(a,s?"touchstart":"mousedown",t,null,{l:b,n:d,c:a,data:f})}function t(a){var b=a.data,d=document.documentElement.scrollLeft||
document.body.scrollLeft,f=document.documentElement.scrollTop||document.body.scrollTop;b.x=a.pageX||a.clientX+d;b.y=a.pageY||a.clientY+f;try{a.T=!1}catch(c){a.preventDefault()}switch(a.type){case "touchend":case "mouseup":b.type="endDrag";r(document,s?"touchmove":"mousemove",t);r(document,s?"touchend":"mouseup",t);b.l.call(b.n,b,a);break;case "touchmove":case "mousemove":b.type="moveDrag";b.i=b.x-b.offsetX;b.j=b.y-b.offsetY;b.l.call(b.n,b,a);break;case "mousedown":b.type="startDrag",b.offsetX=b.x,
b.offsetY=b.y,b.i=0,b.j=0,b.l.call(b.n,b)&&(q(document,s?"touchmove":"mousemove",t,null,b),q(document,s?"touchend":"mouseup",t,null,b))}}function w(a){this.m=a;this.h=100;this.padding=10;this.areas=[];this.d={};this.g=0;this.r()}var s="ontouchstart"in p||p.X&&document instanceof DocumentTouch,c=w.prototype;c.r=function(){this.H();this.B();this.A();this.start()};c.reset=function(){var a=this.d;this.V();a.f.parentNode.removeChild(a.f);a.g.parentNode.removeChild(a.g);this.areas=[];this.d={};this.g=0;
this.r()};c.H=function(){for(var a=0,b=[],d=0;4>d;d++){for(var f=[],c=0;4>c;c++)f.push(c),a++;b.push(f)}this.count=a;this.a=b};c.B=function(){this.G();this.I();this.D()};c.G=function(){var a=document.createElement("div");a.style.position="relative";this.m.appendChild(a);this.d.f=a;this.C();this.U()};c.U=function(){n(this.d.f,{Z:"none",width:4*this.h+3*this.padding+"px",height:4*this.h+3*this.padding+"px"})};c.C=function(){for(var a,b=0;b<this.count;)a={index:b,b:0,c:null,w:null,left:b%4*(this.h+this.padding),
top:Math.floor(b/4)*(this.h+this.padding)},this.areas.push(a),a.w=this.q(b,1),b++};c.q=function(a,b){var d=this.e(a),f=document.createElement("div");n(f,{position:"absolute",width:this.h+"px",height:this.h+"px",lineHeight:this.h+"px",textAlign:"center",borderRadius:"7px",left:d.left+"px",top:d.top+"px",zIndex:!b+2,backgroundColor:b?"#fff5f5":"#f57"});this.d.f.appendChild(f);return f};c.I=function(){var a=document.createElement("div");n(a,{width:"150px",height:"60px",lineHeight:"60px",fontWeight:"bold",
borderRadius:"7px",background:"#272727",color:"#fff",textAlign:"center",fontSize:"24px",marginLeft:"auto",marginRight:"auto",marginTop:"20px"});this.d.g=a;this.m.appendChild(a)};c.D=function(){var a=this.d;a.control=document.createElement("div");this.m.appendChild(a.control);n(a.control,{position:"absolute",right:"100px",bottom:"100px",width:"48px",height:"48px"});for(var a=["top","right","bottom","left"],b=0;b<a.length;b++)this.F(a[b])};c.F=function(a){var b=this.d,d=document.createElement("div");
n(d,{width:"0",height:"0",position:"absolute",borderStyle:"solid",borderColor:"transparent",borderWidth:"24px"});var f={left:"right",top:"bottom"},c,e;for(e in f)f.hasOwnProperty(e)&&(e==a?c=f[e]:f[e]==a&&(c=e));n(d,c,"100%");n(d,"border"+u(c)+"Color","#333");n(d,"border"+u(c)+"Width","48px");n(d,"border"+u(a)+"Width","0");b["ctrl"+a]=d;b.control.appendChild(d);q(d,"click",function(){this.dir=a.charAt(0);this.move()},this)};c.e=function(a){return this.areas[a]};c.Y=function(){var a=[];this.map(function(b){b.c||
a.push(b)});return a};c.N=function(a){return!this.e(a).c};c.S=function(){var a=Math.floor(Math.random()*this.count);return this.N(a)?a:arguments.callee.call(this)};c.map=function(a){for(var b=0;b<this.areas.length;b++)a.call(this,this.areas[b],b)};c.p=function(){var a=2,b=this.S(),d=this.e(b),f=this.q(b);6.5<10*Math.random()&&(a=4);n(f,{fontSize:"20px",color:"#fff"});d.b=a;d.c=f;this.v(b)};c.v=function(a){var b=this.e(a);if(b.c)if(b.b){a=b.c;b=b.b;try{a.innerText=b}catch(d){a.textContent=b}}else this.d.f.removeChild(b.c);
else b.b=0};c.u=function(){var a=this.d.g,b=this.g;try{a.innerText=b}catch(d){a.textContent=b}};c.K=function(){this.complete&&(p.alert("\u7ed3\u675f\u4e86\uff0c\u91cd\u65b0\u5f00\u59cb\u5427"),this.reset())};c.L=function(){var a=!1;this.map(function(b){b.c||(a=!0)});return a};c.J=function(){return this.M()||this.W()};c.M=function(){for(var a=!1,b=0;b<this.a.length;b++)this.a[b].sort(function(b,f){b.b===f.b&&(a=!0);return b.index-f.index});return a};c.W=function(){for(var a=!1,b=0;b<this.a.length;b++){for(var d=
this.a[b],f=[],c=0;c<d.length;c++)f.push(b*d.length+c);f.sort(function(b,d){b.b===d.b&&(a=!0);return b.index-d.index})}return a};c.A=function(){v(this.d.f,this.DragEvent,this);q(document,"keydown",this.s,this)};c.V=function(){v(this.d.f);r(document,"keydown",this.s)};c.s=function(a){var b=a.keyCode||a.charCode||a.which;try{a.T=!1}catch(d){a.preventDefault()}switch(b){case 37:this.dir="l";break;case 38:this.dir="t";break;case 39:this.dir="r";break;case 40:this.dir="b"}this.move()};c.DragEvent=function(a){switch(a.type){case "endDrag":this.dir=
0<=Math.abs(a.i)-Math.abs(a.j)?0<a.i?"r":"l":0<a.j?"b":"t";(30<Math.abs(a.i)||30<Math.abs(a.j))&&this.move();document.body.style.cursor="default";break;case "moveDrag":document.body.style.cursor="move"}return!0};c.move=function(){if(this.t)return!1;this.t=!0;this.o=0;switch(this.dir){case "l":this.P();break;case "r":this.Q();break;case "t":this.R();break;case "b":this.O()}this.moveEnd()};c.moveEnd=function(){this.u();this.L()?(this.o&&this.p(),this.complete=!this.J()):this.complete=!0;this.K();this.t=
!1;this.dir=null;this.o=0};c.P=function(){for(var a,b,d,c,g,e,k,m,h=0;h<this.a.length;h++){m=this.a[h];g=c=-1;d=0;k=!1;b=this.a.length*h;for(var l=0;l<m.length;l++)a=b+l,e=this.e(a),e=e.b,g===e&&(d++,k=!0),0===c&&d++,e&&(g=e),k&&(g=-1,user=!1),c=e,this.k(a,Math.max(b,a-d))}};c.Q=function(){for(var a,b,d,c,g,e,k,m,h=0;h<this.a.length;h++){m=this.a[h];g=c=-1;d=0;k=!1;b=m.length*(h+1)-1;for(var l=0;l<m.length;l++)a=b-l,e=this.e(a),e=e.b,g===e&&(d++,k=!0),0===c&&d++,e&&(g=e),c=e,k&&(g=-1,user=!1),this.k(a,
Math.min(b,a+d))}};c.R=function(){for(var a,b,d,c,g,e,k,m,h=0;h<this.a.length;h++){m=this.a[h];g=c=-1;d=0;k=!1;b=h;for(var l=0;l<m.length;l++)a=l*this.a.length+b,e=this.e(a),e=e.b,g===e&&(d+=this.a.length,k=!0),0===c&&(d+=this.a.length),e&&(g=e),c=e,k&&(g=-1,user=!1),this.k(a,Math.max(b,a-d))}};c.O=function(){for(var a,b,d,c,g,e,k,m,h=0;h<this.a.length;h++){m=this.a[h];g=c=-1;d=0;k=!1;b=(this.a.length-1)*m.length+h;for(var l=0;l<m.length;l++)a=b-l*this.a.length,e=this.e(a),e=e.b,g===e&&(d+=this.a.length,
k=!0),0===c&&(d+=this.a.length),e&&(g=e),c=e,k&&(g=-1,user=!1),this.k(a,Math.min(b,a+d))}};c.k=function(a,b){var d=this.e(a),c=this.e(b);a!==b&&d.c&&(c.b+=d.b,c.c&&(this.d.f.removeChild(c.c),this.g+=c.b),c.c=d.c,n(c.c,{left:c.left+"px",top:c.top+"px"}),d.c=null,d.b=0,this.v(b),this.o++)};c.start=function(){this.p();this.p();this.u()};p.h2048=function(a){return new w(a)}})(window);